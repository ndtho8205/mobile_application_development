<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Exercises 1 - Mobile Application Development</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
    crossorigin="anonymous">

</head>

<body>

  <div id="app" class="container">
    <h1>Exercise 1</h1>
    <h2>Mobile Application Development</h2>
    <hr />

    <div>
      <h3>Part 1</h3>
      <form @submit.prevent="getAddressByLatLng">
        <div class="form-row">
          <input type="text" class="form-control col-md-6 mb-2" placeholder="Latitude" v-model="part1.lat" />
          <input type="text" class="form-control col-md-6 mb-2" placeholder="Longitude" v-model="part1.lng" />
        </div>

        <button type="submit" class="btn btn-primary">FIND ADDRESS</button>
      </form>

      <div class="mt-4" v-if="part1.address">
        <p>Address: {{ part1.address }}</p>
        <p>Latitude: {{ part1.lat }}</p>
        <p>Longtitude: {{part1.lng }}</p>
      </div>
    </div>

    <hr class="mt-5 mb-5" />

    <div>
      <h3>Part 2</h3>
      <form @submit.prevent="getDistanceByLatLng">

        <label>Original:</label>
        <div class="form-row">
          <input type="text" class="form-control col-md-6 mb-2" placeholder="Latitude" v-model="part2.orig.lat"
          />
          <input type="text" class="form-control col-md-6 mb-2" placeholder="Longitude" v-model="part2.orig.lng"
          />
        </div>

        <label>Destination:</label>
        <div class="form-row">
          <input type="text" class="form-control col-md-6 mb-2" placeholder="Latitude" v-model="part2.dest.lat"
          />
          <input type="text" class="form-control col-md-6 mb-2" placeholder="Longitude" v-model="part2.dest.lng"
          />
        </div>

        <button type="submit" class="btn btn-primary">FIND DISTANCE</button>
      </form>

      <div class="mt-4" v-if="part2.distance !== null">
        <p>Distance: {{ part2.distance }}</p>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script>
    //const API_URL = 'https://ex1-mobile-app.herokuapp.com/api';
    const API_URL = `${window.location.protocol}//${window.location.host}/api`;

    const app = new Vue({
      el: '#app',
      data: {
        part1: {
          address: null,
          lat: null,
          lng: null,
        },
        part2: {
          orig: {
            lat: null,
            lng: null,
          },
          dest: {
            lat: null,
            lng: null,
          },
          distance: null,
        },
      },
      methods: {
        getAddressByLatLng() {
          console.log('Getting...');
          axios.get(`${API_URL}/geocode?latlng=${this.part1.lat},${this.part1.lng}`).then((res) => {
            if (res.data.status !== 'OK')
              throw new Error(res.data.error_message);
            result = res.data.result;
            this.part1.address = result.address;
            this.part1.lat = result.lat;
            this.part1.lng = result.lng;
          }).catch((err) => {
            console.log(err);
            this.part1.address = null;
            alert(err.message);
          });
        },

        getDistanceByLatLng() {
          console.log('Getting...');
          axios.get(
            `${API_URL}/distance?orig=${this.part2.orig.lat},${this.part2.orig.lng}&dest=${this.part2.dest.lat},${this.part2.dest.lng}`
          ).then((res) => {
            if (res.data.status !== 'OK') throw new Error(res.data.error_message);
            result = res.data.result;
            this.part2.distance = result.distance;
          }).catch((err) => {
            console.log(err);
            alert(err.message);
          });
        },
      },
    });

  </script>
</body>

</html>
